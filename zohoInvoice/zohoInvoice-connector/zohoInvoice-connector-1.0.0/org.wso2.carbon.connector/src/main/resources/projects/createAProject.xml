<template name="createAProject" xmlns="http://ws.apache.org/ns/synapse">
    <parameter name="authToken" description="API key"/>
    <parameter name="projectName" description="Name of the project"/>
    <parameter name="customerId" description="ID of the customer"/>
    <parameter name="billingType" description="The way you bill your customer"/>
    <parameter name="rate" description="Hourly rate for a task"/>
    <parameter name="budgetType" description="The way you budget"/>
    <parameter name="budgetHours" description="Task budget hours"/>
    <parameter name="budgetAmount" description="Give value, if you are estimating total project cost"/>
    <parameter name="users" description="Details of the users"/>
    <parameter name="tasks" description="Details of the tasks"/>
    <parameter name="description" description="Detail of the project"/>
    <sequence>
        <property name="uri.var.authToken" expression="$func:authToken"/>
        <property name="uri.var.projectName" expression="$func:projectName"/>
        <property name="uri.var.customerId" expression="$func:customerId"/>
        <property name="uri.var.billingType" expression="$func:billingType"/>
        <property name="uri.var.rate" expression="$func:rate"/>
        <property name="uri.var.budgetType" expression="$func:budgetType"/>
        <property name="uri.var.budgetHours" expression="$func:budgetHours"/>
        <property name="uri.var.budgetAmount" expression="$func:budgetAmount"/>
        <property name="uri.var.users" expression="$func:users"/>
        <property name="uri.var.tasks" expression="$func:tasks"/>
        <property name="uri.var.description" expression="$func:description"/>
        <property name="zohoParameters" value=""/>
        <filter
                xpath="get-property('uri.var.description') = '' or  not(string(get-property('uri.var.description')))">
            <then>
                <property name="uri.var.description" value=""/>
            </then>
            <else>
                <property name="zohoParameters" expression="fn:concat(get-property('zohoParameters'),
               ',&quot;description&quot;:&quot;', get-property('uri.var.description'),'&quot;')"/>
            </else>
        </filter>
        <filter
                xpath="get-property('uri.var.rate') = '' or  not(string(get-property('uri.var.rate')))">
            <then>
                <property name="uri.var.rate" value=""/>
            </then>
            <else>
                <property name="zohoParameters" expression="fn:concat(get-property('zohoParameters'),
               ',&quot;rate&quot;:&quot;', get-property('uri.var.rate'),'&quot;')"/>
            </else>
        </filter>
        <filter
                xpath="get-property('uri.var.budgetType') = '' or  not(string(get-property('uri.var.budgetType')))">
            <then>
                <property name="uri.var.budgetType" value=""/>
            </then>
            <else>
                <property name="zohoParameters" expression="fn:concat(get-property('zohoParameters'),
               ',&quot;budget_type&quot;:&quot;', get-property('uri.var.budgetType'),'&quot;')"/>
            </else>
        </filter>
        <filter
                xpath="get-property('uri.var.budgetHours') = '' or  not(string(get-property('uri.var.budgetHours')))">
            <then>
                <property name="uri.var.budgetHours" value=""/>
            </then>
            <else>
                <property name="zohoParameters" expression="fn:concat(get-property('zohoParameters'),
               ',&quot;budget_hours&quot;:&quot;', get-property('uri.var.budgetHours'),'&quot;')"/>
            </else>
        </filter>
        <filter
                xpath="get-property('uri.var.budgetAmount') = '' or  not(string(get-property('uri.var.budgetAmount')))">
            <then>
                <property name="uri.var.budgetAmount" value=""/>
            </then>
            <else>
                <property name="zohoParameters" expression="fn:concat(get-property('zohoParameters'),
               ',&quot;budget_amount&quot;:&quot;', get-property('uri.var.budgetAmount'),'&quot;')"/>
            </else>
        </filter>
        <filter
                xpath="get-property('uri.var.users') = '' or  not(string(get-property('uri.var.users')))">
            <then>
                <property name="uri.var.users" value=""/>
            </then>
            <else>
                <property name="zohoParameters" expression="fn:concat(get-property('zohoParameters'),
               ',&quot;users&quot;:',get-property('uri.var.users'))"/>
            </else>
        </filter>
        <filter
                xpath="get-property('uri.var.tasks') = '' or  not(string(get-property('uri.var.tasks')))">
            <then>
                <property name="uri.var.tasks" value=""/>
            </then>
            <else>
                <property name="zohoParameters" expression="fn:concat(get-property('zohoParameters'),
               ',&quot;tasks&quot;:',get-property('uri.var.tasks'))"/>
            </else>
        </filter>
        <property name="uri.var.parameters" expression="get-property('zohoParameters')"/>
        <call>
            <endpoint>
                <http method="post"
                      uri-template="{uri.var.apiUrl}/projects?authtoken={uri.var.authToken}&amp;JSONString={&quot;project_name&quot;:&quot;{uri.var.projectName}&quot;,&quot;customer_id&quot;:&quot;{uri.var.customerId}&quot;,&quot;billing_type&quot;:&quot;{uri.var.billingType}&quot;{uri.var.parameters}} "/>
            </endpoint>
        </call>
        <!-- Remove response custom header information -->
        <header name="x-li-format" scope="transport" action="remove"/>
        <header name="X-LI-UUID" scope="transport" action="remove"/>
        <header name="X-Li-Pop" scope="transport" action="remove"/>
        <header name="X-Li-Fabric" scope="transport" action="remove"/>
        <header name="x-li-request-id" scope="transport" action="remove"/>
    </sequence>
</template>